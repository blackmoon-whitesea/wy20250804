#include "Audio.h" 
#include "usart.h" 
#include "delay.h" 
#include "malloc.h"
#include "i2s.h"
#include "wm8978.h"
#include "key.h"
#include "rtp.h"
#include "SipFunction.h"
#include "SipConstant.h"
#include "tel_func.h"

#define RING_HEX_LEN		163*16
const vu8 gRingArr[RING_HEX_LEN]={
0x1D ,0x07 ,0x06 ,0x1B ,0x69 ,0xFB ,0x98 ,0x82 ,0x8F ,0x82 ,0x98 ,0xDF ,0x1A ,0x0B ,0x31 ,0x32,
0x30 ,0x35 ,0x1B ,0xE7 ,0x8D ,0xB6 ,0xBD ,0xB2 ,0xB6 ,0x80 ,0x54 ,0x00 ,0x36 ,0x3D ,0x3D ,0x36,
0x01 ,0xC0 ,0x82 ,0xB1 ,0xBD ,0xBD ,0xB7 ,0x85 ,0x15 ,0x35 ,0x3C ,0x3B ,0x38 ,0x32 ,0x0C ,0xC7,
0x8E ,0xBD ,0xB8 ,0xB8 ,0xBD ,0x8F ,0x5D ,0x09 ,0x3C ,0x3A ,0x25 ,0x3F ,0x08 ,0x47 ,0x8E ,0xBC,
0xA5 ,0xA5 ,0xBF ,0x8B ,0xDD ,0x08 ,0x3E ,0x24 ,0x24 ,0x38 ,0x37 ,0x6B ,0x83 ,0xBD ,0xA5 ,0xA5,
0xB9 ,0xB4 ,0xE8 ,0x03 ,0x32 ,0x3A ,0x25 ,0x39 ,0x37 ,0x14 ,0x81 ,0xB3 ,0xBB ,0xA5 ,0xBE ,0xB4,
0x95 ,0x01 ,0x33 ,0x3B ,0x25 ,0x39 ,0x37 ,0x10 ,0x84 ,0xB1 ,0xB9 ,0xBB ,0xBF ,0xB4 ,0x94 ,0x07,
0x30 ,0x39 ,0x3B ,0x3F ,0x34 ,0x16 ,0x84 ,0xB1 ,0xB9 ,0xBB ,0xBF ,0xB5 ,0xEB ,0x01 ,0x33 ,0x3B,
0x25 ,0x3E ,0x34 ,0x14 ,0x87 ,0xB0 ,0xB9 ,0xBB ,0xBC ,0x8A ,0xE3 ,0x03 ,0x33 ,0x3B ,0x25 ,0x3E,
0x34 ,0x14 ,0x86 ,0xB0 ,0xB8 ,0xBA ,0xBF ,0xB5 ,0xED ,0x03 ,0x32 ,0x3B ,0x25 ,0x3E ,0x34 ,0x6E,
0x80 ,0xB3 ,0xBB ,0xBA ,0xBF ,0x8A ,0xFB ,0x0C ,0x3D ,0x25 ,0x25 ,0x39 ,0x37 ,0x15 ,0x80 ,0xB2,
0xBB ,0xA5 ,0xBE ,0xB5 ,0xFB ,0x0F ,0x3F ,0x24 ,0x24 ,0x38 ,0x37 ,0x6C ,0x8D ,0xBC ,0xA5 ,0xA4,
0xB9 ,0xB4 ,0xF8 ,0x0E ,0x3F ,0x24 ,0x24 ,0x38 ,0x37 ,0x6E ,0x82 ,0xBD ,0xA5 ,0xA5 ,0xB9 ,0xB4,
0xE6 ,0x0C ,0x3C ,0x25 ,0x24 ,0x38 ,0x37 ,0x68 ,0x83 ,0xB2 ,0xBA ,0xA5 ,0xBF ,0x8A ,0xFE ,0x0C,
0x3C ,0x25 ,0x25 ,0x3E ,0x35 ,0x64 ,0x8D ,0xBD ,0xBA ,0xBA ,0xBF ,0x8B ,0xCA ,0x0E ,0x3C ,0x25,
0x25 ,0x39 ,0x34 ,0x63 ,0x82 ,0xBD ,0xBA ,0xA5 ,0xBE ,0xB5 ,0xE5 ,0x0D ,0x3D ,0x3A ,0x25 ,0x3E,
0x35 ,0x67 ,0x8D ,0xBD ,0xBA ,0xBA ,0xBF ,0x8B ,0xC9 ,0x0E ,0x3C ,0x25 ,0x25 ,0x3E ,0x35 ,0x64,
0x8D ,0xBD ,0xBA ,0xA5 ,0xBF ,0x8A ,0xF6 ,0x0E ,0x3C ,0x25 ,0x24 ,0x39 ,0x34 ,0x61 ,0x8C ,0xBC,
0xA5 ,0xA4 ,0xB9 ,0xB5 ,0xFC ,0x0E ,0x3F ,0x25 ,0x24 ,0x39 ,0x35 ,0x7A ,0x8F ,0xBF ,0xA5 ,0xA4,
0xB9 ,0xB4 ,0xE5 ,0x0E ,0x3E ,0x24 ,0x27 ,0x3B ,0x36 ,0x68 ,0x8D ,0xBC ,0xA4 ,0xA4 ,0xB8 ,0xB4,
0xF9 ,0x09 ,0x3E ,0x24 ,0x24 ,0x39 ,0x34 ,0x15 ,0x86 ,0xB1 ,0xB9 ,0xBB ,0xBE ,0xB6 ,0x87 ,0x67,
0x0F ,0x30 ,0x3C ,0x3C ,0x33 ,0x0A ,0x05 ,0x5D ,0x9C ,0x83 ,0x8E ,0x8E ,0x8D ,0x87 ,0x92 ,0xE0,
0x57 ,0x7B ,0x61 ,0x66 ,0x7C ,0x4F ,0x47 ,0x70 ,0x6D ,0x13 ,0x04 ,0x03 ,0x0D ,0x0D ,0x01 ,0x1C,
0x71 ,0x95 ,0x87 ,0x8C ,0x88 ,0x89 ,0x83 ,0x9C ,0xC1 ,0x10 ,0x00 ,0x08 ,0x35 ,0x35 ,0x0E ,0x07,
0x15 ,0xFF ,0x9E ,0x80 ,0x8C ,0x8F ,0x83 ,0x85 ,0xEA ,0x5A ,0x17 ,0x1A ,0x06 ,0x00 ,0x00 ,0x06,
0x05 ,0x1D ,0x6B ,0x4B ,0xE4 ,0x90 ,0x85 ,0x81 ,0x83 ,0x80 ,0x87 ,0x9D ,0xE4 ,0x7A ,0x12 ,0x07,
0x02 ,0x0C ,0x0C ,0x03 ,0x05 ,0x17 ,0x44 ,0xE9 ,0x99 ,0x86 ,0x83 ,0x83 ,0x87 ,0x9F ,0xE2 ,0x77,
0x11 ,0x05 ,0x00 ,0x02 ,0x02 ,0x01 ,0x1A ,0x17 ,0x49 ,0xE2 ,0x9C ,0x87 ,0x81 ,0x81 ,0x84 ,0x92,
0xE1 ,0x4C ,0x68 ,0x12 ,0x18 ,0x05 ,0x05 ,0x1B ,0x1E ,0x13 ,0x6A ,0x7A ,0xDE ,0xE2 ,0x90 ,0x9B,
0x87 ,0x86 ,0x84 ,0x9F ,0xEF ,0x58 ,0x14 ,0x1A ,0x00 ,0x0D ,0x0D ,0x03 ,0x05 ,0x17 ,0xD5 ,0x97,
0x84 ,0x83 ,0x8D ,0x83 ,0x87 ,0x93 ,0xFD ,0x66 ,0x12 ,0x04 ,0x01 ,0x00 ,0x01 ,0x04 ,0x1F ,0x15,
0x74 ,0xFB ,0x97 ,0x99 ,0x84 ,0x87 ,0x84 ,0x99 ,0x96 ,0xFE ,0x7C ,0x17 ,0x18 ,0x07 ,0x00 ,0x00,
0x06 ,0x1B ,0x17 ,0x74 ,0xE1 ,0x92 ,0x85 ,0x86 ,0x81 ,0x84 ,0x9F ,0xEE ,0x51 ,0x69 ,0x1F ,0x04,
0x01 ,0x01 ,0x06 ,0x05 ,0x1D ,0x6D ,0xD2 ,0xE8 ,0x9E ,0x87 ,0x81 ,0x81 ,0x85 ,0x90 ,0xFD ,0x61,
0x1C ,0x07 ,0x03 ,0x0D ,0x02 ,0x06 ,0x18 ,0x15 ,0x47 ,0xE0 ,0x93 ,0x9B ,0x84 ,0x84 ,0x9A ,0x9C,
0xEA ,0xF5 ,0x65 ,0x11 ,0x1A ,0x01 ,0x02 ,0x02 ,0x03 ,0x04 ,0x13 ,0x7D ,0xED ,0x98 ,0x80 ,0x8C,
0x8C ,0x83 ,0x9A ,0xE8 ,0x4A ,0x10 ,0x07 ,0x03 ,0x0C ,0x0D ,0x00 ,0x05 ,0x16 ,0x72 ,0xFA ,0x91,
0x9B ,0x87 ,0x86 ,0x87 ,0x98 ,0x96 ,0xF2 ,0x7A ,0x11 ,0x1B ,0x07 ,0x01 ,0x01 ,0x07 ,0x1B ,0x11,
0x78 ,0xFE ,0x91 ,0x85 ,0x86 ,0x81 ,0x87 ,0x98 ,0x94 ,0xCF ,0x60 ,0x1D ,0x04 ,0x00 ,0x03 ,0x00,
0x06 ,0x19 ,0x6A ,0x5D ,0xEE ,0x9E ,0x86 ,0x80 ,0x83 ,0x86 ,0x9E ,0xEC ,0x48 ,0x16 ,0x05 ,0x00,
0x0D ,0x0D ,0x00 ,0x05 ,0x14 ,0x5D ,0xEA ,0x98 ,0x86 ,0x80 ,0x81 ,0x85 ,0x92 ,0xE2 ,0x57 ,0x62,
0x13 ,0x1A ,0x06 ,0x01 ,0x01 ,0x05 ,0x10 ,0x72 ,0xE0 ,0x9C ,0x87 ,0x86 ,0x85 ,0x91 ,0xDF ,0x17,
0x05 ,0x01 ,0x04 ,0x11 ,0xC6 ,0x9F ,0x82 ,0x89 ,0x8E ,0x87 ,0xE7 ,0x1F ,0x0B ,0x33 ,0x3C ,0x3D,
0x37 ,0x06 ,0xC8 ,0x82 ,0xB1 ,0xBC ,0xBC ,0xB0 ,0x8C ,0xFA ,0x07 ,0x37 ,0x3D ,0x3C ,0x30 ,0x0C,
0x73 ,0x81 ,0xB6 ,0xBC ,0xBC ,0xB1 ,0x80 ,0x7D ,0x09 ,0x3D ,0x3B ,0x3B ,0x3D ,0x09 ,0x72 ,0x82,
0xB3 ,0xB9 ,0xB8 ,0xBD ,0x88 ,0xFA ,0x03 ,0x33 ,0x38 ,0x3B ,0x3F ,0x35 ,0x6E ,0x81 ,0xB0 ,0xB9,
0xBB ,0xBC ,0x8B ,0xFB ,0x0D ,0x3D ,0x25 ,0x24 ,0x38 ,0x37 ,0x11 ,0x87 ,0xB0 ,0xB8 ,0xBA ,0xBE,
0xB4 ,0xEA ,0x01 ,0x33 ,0x3B ,0x25 ,0x3E ,0x34 ,0x15 ,0x81 ,0xB3 ,0xBB ,0xA5 ,0xBE ,0xB4 ,0xEC,
0x02 ,0x3D ,0x25 ,0x24 ,0x38 ,0x37 ,0x16 ,0x86 ,0xB3 ,0xBB ,0xBA ,0xBF ,0xB5 ,0xE4 ,0x0D ,0x3D,
0x3A ,0x25 ,0x3E ,0x35 ,0x61 ,0x8D ,0xBD ,0xBA ,0xA5 ,0xBE ,0xB5 ,0xFC ,0x0E ,0x3F ,0x25 ,0x24,
0x39 ,0x34 ,0x64 ,0x8F ,0xBC ,0xA5 ,0xA5 ,0xBE ,0x8A ,0xCD ,0x08 ,0x3E ,0x24 ,0x24 ,0x39 ,0x35,
0x7D ,0x8F ,0xBC ,0xA5 ,0xA5 ,0xBF ,0x88 ,0xDF ,0x09 ,0x3F ,0x25 ,0x25 ,0x3E ,0x0A ,0x7C ,0x8C,
0xBD ,0xBB ,0xBA ,0xBD ,0x8E ,0x45 ,0x08 ,0x3C ,0x25 ,0x25 ,0x3C ,0x09 ,0x56 ,0x89 ,0xBC ,0xBA,
0xBA ,0xBD ,0x8C ,0x71 ,0x0B ,0x3F ,0x25 ,0x3A ,0x3D ,0x0F ,0xC9 ,0x88 ,0xBC ,0xBA ,0xBB ,0xB2,
0x82 ,0x67 ,0x35 ,0x3E ,0x25 ,0x25 ,0x3C ,0x0F ,0xCF ,0x88 ,0xBC ,0xBA ,0xBB ,0xB2 ,0x8D ,0x67,
0x35 ,0x3E ,0x25 ,0x3A ,0x3D ,0x0D ,0xFA ,0x8A ,0xBF ,0xBA ,0xBB ,0xB3 ,0x81 ,0x15 ,0x34 ,0x39,
0x25 ,0x3A ,0x32 ,0x03 ,0xEF ,0xB4 ,0xBE ,0xA5 ,0xBB ,0xB3 ,0x86 ,0x10 ,0x36 ,0x3B ,0x24 ,0x25,
0x3D ,0x02 ,0xEB ,0xB7 ,0xB8 ,0xA4 ,0xA5 ,0xB2 ,0x81 ,0x10 ,0x31 ,0x3A ,0x27 ,0x24 ,0x3C ,0x02,
0x95 ,0xB7 ,0xB8 ,0xA4 ,0xA5 ,0xB2 ,0x86 ,0x12 ,0x31 ,0x3B ,0x24 ,0x25 ,0x32 ,0x01 ,0x90 ,0xB6,
0xB8 ,0xA5 ,0xBB ,0xB0 ,0x85 ,0x19 ,0x31 ,0x3B ,0x24 ,0x3A ,0x33 ,0x07 ,0x90 ,0xB7 ,0xB9 ,0xA5,
0xB8 ,0xB1 ,0x98 ,0x1B ,0x30 ,0x3B ,0x24 ,0x3A ,0x30 ,0x04 ,0x9C ,0xB6 ,0xB8 ,0xA5 ,0xB8 ,0xB1,
0x9E ,0x1B ,0x31 ,0x3B ,0x25 ,0x38 ,0x31 ,0x18 ,0x98 ,0xB1 ,0xB8 ,0xBA ,0xBE ,0xB7 ,0x91 ,0x04,
0x30 ,0x38 ,0x3A ,0x3E ,0x36 ,0x18 ,0x93 ,0xB4 ,0xBC ,0xB9 ,0xBF ,0xB1 ,0x80 ,0x43 ,0x02 ,0x31,
0x3D ,0x3C ,0x33 ,0x35 ,0x05 ,0x55 ,0x99 ,0x8D ,0x88 ,0x88 ,0x8C ,0x87 ,0x91 ,0xFE ,0x43 ,0x79,
0x79 ,0x4B ,0xD6 ,0xCE ,0xCC ,0x5F ,0x61 ,0x13 ,0x04 ,0x02 ,0x0F ,0x0C ,0x06 ,0x16 ,0xF5 ,0x99,
0x8D ,0x8B ,0x8A ,0x8E ,0x81 ,0x96 ,0x4A ,0x1F ,0x03 ,0x08 ,0x0A ,0x08 ,0x0D ,0x05 ,0x6D ,0xE4,
0x9E ,0x80 ,0x8C ,0x8C ,0x83 ,0x85 ,0xEB ,0x43 ,0x16 ,0x05 ,0x00 ,0x02 ,0x02 ,0x00 ,0x04 ,0x1D,
0x6D ,0xD8 ,0xEA ,0x99 ,0x87 ,0x81 ,0x81 ,0x84 ,0x9C ,0xED ,0x5E ,0x6B ,0x1E ,0x06 ,0x03 ,0x0D,
0x02 ,0x01 ,0x1A ,0x17 ,0x46 ,0xEE ,0x98 ,0x81 ,0x82 ,0x83 ,0x87 ,0x93 ,0xF7 ,0x6E ,0x18 ,0x01,
0x0D ,0x0D ,0x03 ,0x04 ,0x13 ,0x65 ,0xFF ,0x96 ,0x99 ,0x85 ,0x84 ,0x9B ,0x93 ,0xEF ,0xC3 ,0x78,
0x15 ,0x12 ,0x19 ,0x1B ,0x1A ,0x1A ,0x19 ,0x12 ,0x15 ,0x7F ,0xF0 ,0x97 ,0x98 ,0x87 ,0x81 ,0x87,
0x99 ,0xE8 ,0x59 ,0x14 ,0x05 ,0x03 ,0x0C ,0x0F ,0x02 ,0x07 ,0x10 ,0x49 ,0xE8 ,0x9B ,0x81 ,0x82,
0x83 ,0x87 ,0x9D ,0xE6 ,0x7D ,0x11 ,0x1B ,0x07 ,0x01 ,0x06 ,0x07 ,0x1B ,0x10 ,0x60 ,0xC6 ,0x94,
0x9A ,0x80 ,0x82 ,0x83 ,0x87 ,0x92 ,0xFA ,0x65 ,0x13 ,0x05 ,0x01 ,0x00 ,0x01 ,0x04 ,0x1F ,0x6A,
0x48 ,0xE4 ,0x91 ,0x98 ,0x84 ,0x87 ,0x84 ,0x99 ,0x94 ,0xF5 ,0x61 ,0x12 ,0x04 ,0x00 ,0x02 ,0x03,
0x06 ,0x19 ,0x69 ,0xDB ,0x97 ,0x85 ,0x81 ,0x83 ,0x80 ,0x84 ,0x90 ,0xFC ,0x64 ,0x10 ,0x1A ,0x06,
0x06 ,0x07 ,0x1A ,0x12 ,0x6F ,0x44 ,0xE7 ,0x96 ,0x99 ,0x84 ,0x87 ,0x84 ,0x98 ,0x96 ,0xFF ,0x79,
0x11 ,0x05 ,0x01 ,0x02 ,0x02 ,0x00 ,0x04 ,0x11 ,0x4B ,0xE9 ,0x9B ,0x80 ,0x8D ,0x8D ,0x81 ,0x9E,
0xE1 ,0x7B ,0x1D ,0x07 ,0x03 ,0x0D ,0x02 ,0x06 ,0x18 ,0x15 ,0x42 ,0xE0 ,0x93 ,0x85 ,0x87 ,0x86,
0x84 ,0x9E ,0xEA ,0xC4 ,0x62 ,0x1D ,0x05 ,0x01 ,0x00 ,0x00 ,0x07 ,0x18 ,0x14 ,0x42 ,0xE2 ,0x9D,
0x84 ,0x86 ,0x86 ,0x84 ,0x9D ,0xE2 ,0x41 ,0x15 ,0x19 ,0x07 ,0x00 ,0x03 ,0x00 ,0x06 ,0x18 ,0x14,
0x43 ,0xEE ,0x98 ,0x80 ,0x8C ,0x8C ,0x80 ,0x9E ,0xE7 ,0x61 ,0x19 ,0x00 ,0x0C ,0x0F ,0x0D ,0x01,
0x19 ,0x6D ,0xF4 ,0x96 ,0x9A ,0x86 ,0x86 ,0x87 ,0x99 ,0x97 ,0xF9 ,0x76 ,0x15 ,0x19 ,0x07 ,0x00,
0x03 ,0x01 ,0x1A ,0x14 ,0x51 ,0xEA ,0x98 ,0x87 ,0x87 ,0x9F ,0xE0 ,0x65 ,0x1C ,0x04 ,0x04 ,0x12,
0x4A ,0x96 ,0x86 ,0x8F ,0x8E ,0x80 ,0x96 ,0x6D ,0x03 ,0x37 ,0x33 ,0x32 ,0x36 ,0x0D ,0x60 ,0x9B,
0xB5 ,0xB3 ,0xBD ,0xB0 ,0x88 ,0x96 ,0x12 ,0x0A ,0x33 ,0x3D ,0x30 ,0x09 ,0x15 ,0x99 ,0xB5 ,0xB2,
0xBD ,0xB0 ,0x8C ,0xF7 ,0x03 ,0x30 ,0x39 ,0x38 ,0x3C ,0x35 ,0x6B ,0x87 ,0xB1 ,0xBE ,0xB8 ,0xBF,
0xB5 ,0x97 ,0x04 ,0x31 ,0x38 ,0x3A ,0x3E ,0x37 ,0x13 ,0x84 ,0xB0 ,0xB8 ,0xA5 ,0xB9 ,0xB6 ,0x90,
0x06 ,0x32 ,0x25 ,0x24 ,0x25 ,0x33 ,0x1A ,0x9B ,0xB0 ,0xBA ,0xA4 ,0xBB ,0xB1 ,0x9E ,0x05 ,0x33,
0x3A ,0x24 ,0x3B ,0x30 ,0x1B ,0x99 ,0xB1 ,0xB8 ,0xA5 ,0xB8 ,0xB6 ,0x9F ,0x05 ,0x30 ,0x3B ,0x25,
0x3B ,0x30 ,0x04 ,0x93 ,0xB7 ,0xBE ,0xBA ,0xB9 ,0xB6 ,0x9E ,0x18 ,0x31 ,0x38 ,0x25 ,0x38 ,0x31,
0x1B ,0x9C ,0xB7 ,0xBE ,0xBB ,0xBE ,0xB7 ,0x90 ,0x04 ,0x30 ,0x38 ,0x25 ,0x39 ,0x36 ,0x1E ,0x99,
0xB6 ,0xBE ,0xBB ,0xBF ,0xB4 ,0x94 ,0x06 ,0x33 ,0x3B ,0x25 ,0x39 ,0x37 ,0x13 ,0x85 ,0xB1 ,0xB9,
0xBB ,0xBF ,0xB4 ,0xEB ,0x01 ,0x33 ,0x3B ,0x3A ,0x3E ,0x34 ,0x14 ,0x86 ,0xB0 ,0xB8 ,0xBB ,0xBF,
0x8A ,0xE4 ,0x0D ,0x3D ,0x25 ,0x25 ,0x39 ,0x34 ,0x68 ,0x83 ,0xB2 ,0xBB ,0xA5 ,0xBF ,0x8A ,0xF6,
0x0E ,0x3C ,0x25 ,0x25 ,0x3E ,0x35 ,0x79 ,0x8F ,0xBC ,0xA5 ,0xA4 ,0xB9 ,0xB5 ,0xF2 ,0x09 ,0x3E,
0x24 ,0x27 ,0x38 ,0x34 ,0x64 ,0x8E ,0xBF ,0xA4 ,0xA4 ,0xB9 ,0xB5 ,0xFC ,0x09 ,0x3F ,0x24 ,0x24,
0x39 ,0x34 ,0x61 ,0x8D ,0xBD ,0xBA ,0xA5 ,0xBF ,0x88 ,0xDB ,0x09 ,0x3F ,0x25 ,0x25 ,0x3E ,0x0A,
0x71 ,0x8F ,0xBC ,0xBA ,0xA5 ,0xBC ,0x89 ,0x47 ,0x0B ,0x3E ,0x25 ,0x25 ,0x3F ,0x08 ,0x51 ,0x89,
0xBC ,0xA5 ,0xBA ,0xBC ,0x8E ,0x58 ,0x08 ,0x3C ,0x25 ,0x25 ,0x3C ,0x09 ,0x50 ,0x8E ,0xBC ,0xBA,
0xBB ,0xBD ,0x8C ,0x7F ,0x0A ,0x3E ,0x25 ,0x25 ,0x3C ,0x0E ,0xCA ,0x8B ,0xBF ,0xBA ,0xBB ,0xB2,
0x83 ,0x6C ,0x34 ,0x39 ,0x25 ,0x25 ,0x3D ,0x0D ,0xE7 ,0xB5 ,0xBE ,0xA5 ,0xBA ,0xB2 ,0x80 ,0x15,
0x37 ,0x38 ,0x24 ,0x25 ,0x3C ,0x0C ,0xE0 ,0xB4 ,0xB9 ,0xA5 ,0xBA ,0xB2 ,0x80 ,0x11 ,0x36 ,0x3A,
0x27 ,0x24 ,0x3F ,0x0C ,0xEF ,0xB7 ,0xB8 ,0xA4 ,0xA5 ,0xB2 ,0x86 ,0x13 ,0x36 ,0x3B ,0x24 ,0x25,
0x3C ,0x0C ,0xF6 ,0x88 ,0xBC ,0xBB ,0xBB ,0xBC ,0x8A ,0xE8 ,0x05 ,0x37 ,0x3C ,0x3E ,0x3C ,0x31,
0x0D ,0x6F ,0x96 ,0x83 ,0x89 ,0x8B ,0x8F ,0x86 ,0x92 ,0xE5 ,0x46 ,0x65 ,0x67 ,0x79 ,0x49 ,0x51,
0x55 ,0x4D ,0x61 ,0x11 ,0x05 ,0x00 ,0x0D ,0x0C ,0x00 ,0x1E ,0x79 ,0xEA ,0x87 ,0x8F ,0x8B ,0x88,
0x8D ,0x85 ,0xE2 ,0x61 ,0x1B ,0x02 ,0x0E ,0x09 ,0x0C ,0x06 ,0x10 ,0x5B ,0x97 ,0x84 ,0x82 ,0x8F,
0x8C ,0x81 ,0x9C ,0xFB ,0x60 ,0x1F ,0x07 ,0x03 ,0x02 ,0x03 ,0x06 ,0x18 ,0x17 ,0x74 ,0xE1 ,0x9D,
0x84 ,0x80 ,0x83 ,0x81 ,0x85 ,0x90 ,0xE4 ,0x70 ,0x17 ,0x1B ,0x06 ,0x03 ,0x03 ,0x00 ,0x04 ,0x12,
0x67 ,0xFE ,0x92 ,0x87 ,0x82 ,0x8D ,0x83 ,0x84 ,0x97 ,0xD5 ,0x17 ,0x05 ,0x03 ,0x0D ,0x02 ,0x01,
0x18 ,0x68 ,0xD2 ,0xEA ,0x9E ,0x84 ,0x87 ,0x85 ,0x9F ,0x94 ,0xFB ,0x45 ,0x61 ,0x14 ,0x13 ,0x1F,
0x19 ,0x1B ,0x1B ,0x19 ,0x12 ,0x6B ,0x49 ,0xE0 ,0x9D ,0x87 ,0x83 ,0x83 ,0x86 ,0x9F ,0xE3 ,0x72,
0x13 ,0x04 ,0x03 ,0x0D ,0x02 ,0x01 ,0x19 ,0x6E ,0xC7 ,0x94 ,0x9B ,0x86 ,0x81 ,0x86 ,0x9A ,0x96,
0xF0 ,0x66 ,0x12 ,0x04 ,0x00 ,0x02 ,0x03 ,0x01 ,0x1A ,0x11 ,0x79 ,0xFF ,0x96 ,0x9B ,0x87 ,0x87,
0x84 ,0x9F ,0xE8 ,0xDF ,0x6D ,0x12 ,0x05 ,0x06 ,0x01 ,0x06 ,0x05 ,0x1D ,0x6E ,0x58 ,0xE0 ,0x90,
0x9B ,0x87 ,0x87 ,0x84 ,0x9C ,0xEE ,0x55 ,0x69 ,0x1E ,0x07 ,0x00 ,0x03 ,0x00 ,0x04 ,0x12 ,0x64,
0xF9 ,0x93 ,0x84 ,0x80 ,0x83 ,0x86 ,0x99 ,0xE8 ,0x50 ,0x6A ,0x19 ,0x07 ,0x01 ,0x01 ,0x07 ,0x1B,
0x13 ,0x6D ,0x58 ,0xE7 ,0x96 ,0x99 ,0x84 ,0x86 ,0x87 ,0x9B ,0x96 ,0xF0 ,0x66 ,0x1D ,0x07 ,0x03,
0x0D ,0x0D ,0x00 ,0x1A ,0x6B ,0xCB ,0x93 ,0x87 ,0x82 ,0x8C ,0x82 ,0x84 ,0x90 ,0xF0 ,0x61 ,0x1D,
0x04 ,0x00 ,0x03 ,0x03 ,0x06 ,0x1B ,0x16 ,0x7C ,0xFB ,0x90 ,0x85 ,0x81 ,0x80 ,0x86 ,0x98 ,0x95,
0xC7 ,0x6D ,0x1D ,0x05 ,0x06 ,0x01 ,0x07 ,0x1B ,0x10 ,0x66 ,0xC1 ,0xE8 ,0x9C ,0x85 ,0x87 ,0x87,
0x9A ,0x9D ,0xEF ,0xDD ,0x62 ,0x12 ,0x05 ,0x06 ,0x00 ,0x01 ,0x07 ,0x1E ,0x68 ,0xD2 ,0x94 ,0x85,
0x80 ,0x82 ,0x83 ,0x84 ,0x90 ,0xC8 ,0x69 ,0x18 ,0x01 ,0x0D ,0x0C ,0x02 ,0x07 ,0x1D ,0x66 ,0xF0,
0x96 ,0x98 ,0x87 ,0x86 ,0x84 ,0x98 ,0x91 ,0xE6 ,0x40 ,0x6B ,0x1F ,0x04 ,0x01 ,0x00 ,0x06 ,0x1A,
0x17 ,0x42 ,0xEE ,0x9E ,0x87 ,0x87 ,0x9F ,0xE6 ,0x61 ,0x19 ,0x06 ,0x01 ,0x18 ,0x60 ,0xEF ,0x84,
0x8C ,0x8E ,0x82 ,0x9D ,0x7B ,0x00 ,0x37 ,0x32 ,0x3C ,0x33 ,0x0B ,0x13 ,0x91 ,0x8B ,0xB3 ,0xBF,
0xBD ,0xB7 ,0x84 ,0x63 ,0x09 ,0x33 ,0x3F ,0x3D ,0x37 ,0x1B ,0x94 ,0x8A ,0xB2 ,0xBF ,0xBD ,0xB5,
0x91 ,0x1A ,0x36 ,0x39 ,0x3A ,0x39 ,0x31 ,0x04 ,0x94 ,0xB5 ,0xBC ,0xB8 ,0xBE ,0xB1 ,0x84 ,0x17,
0x34 ,0x3F ,0x3A ,0x38 ,0x30 ,0x06 ,0x95 ,0xB4 ,0xBF ,0xBA ,0xB8 ,0xB0 ,0x87 ,0x11 ,0x37 ,0x39,
0x25 ,0x3A ,0x32 ,0x02 ,0xED ,0xB5 ,0xBE ,0xA5 ,0xBB ,0xB3 ,0x80 ,0x6B ,0x34 ,0x3E ,0x25 ,0x3A,
0x32 ,0x03 ,0xE0 ,0xB5 ,0xBF ,0xBA ,0xB8 ,0xB3 ,0x86 ,0x14 ,0x37 ,0x39 ,0x25 ,0x3A ,0x32 ,0x03,
0xEF ,0xB5 ,0xBF ,0xBA ,0xB8 ,0xB0 ,0x87 ,0x16 ,0x37 ,0x39 ,0x25 ,0x3B ,0x33 ,0x06 ,0x96 ,0xB7,
0xB9 ,0xA5 ,0xB8 ,0xB0 ,0x85 ,0x1F ,0x31 ,0x3B ,0x24 ,0x3A ,0x33 ,0x04 ,0x9C ,0xB1 ,0xBB ,0xA5,
0xBB ,0xB1 ,0x9C ,0x07 ,0x32 ,0x25 ,0x24 ,0x25 ,0x30 ,0x1B ,0x85 ,0xB3 ,0xBA ,0xA4 ,0xBB ,0xB6,
0x93 ,0x06 ,0x32 ,0x3A ,0x24 ,0x3B ,0x36 ,0x12 ,0x87 ,0xB3 ,0xBB ,0xA5 ,0xBE ,0xB4 ,0xE9 ,0x03,
0x3D ,0x3A ,0x25 ,0x39 ,0x34 ,0x68 ,0x80 ,0xB2 ,0xBB ,0xBA ,0xBC ,0x88 ,0xC3 ,0x0E ,0x3C ,0x25,
0x25 ,0x3F ,0x0A ,0x65 ,0x82 ,0xB2 ,0xB8 ,0xBB ,0xBD ,0x8F ,0x48 ,0x0B ,0x3F ,0x25 ,0x25 ,0x3F,
0x08 ,0x44 ,0x8E ,0xBC ,0xBA ,0xBB ,0xBD ,0x8F ,0x4B ,0x08 ,0x3C ,0x3A ,0x3A ,0x3D ,0x0F ,0xC3,
0x89 ,0xBD ,0xBB ,0xB8 ,0xB3 ,0x80 ,0x6F ,0x35 ,0x3E ,0x25 ,0x3A ,0x3D ,0x0D ,0xE6 ,0xB5 ,0xBF,
0xBA ,0xBB ,0xB3 ,0x86 ,0x16 ,0x36 ,0x38 ,0x24 ,0x25 ,0x3D ,0x02 ,0xEF ,0xB4 ,0xB9 ,0xA5 ,0xBA,
0xB2 ,0x81 ,0x16 ,0x36 ,0x3B ,0x24 ,0x25 ,0x3D ,0x02 ,0xEA ,0xB7 ,0xB8 ,0xA4 ,0xA5 ,0xB2 ,0x86,
0x1D ,0x31 ,0x3A ,0x27 ,0x25 ,0x3D ,0x01 ,0x90 ,0xB6 ,0xBB ,0xA4 ,0xBA ,0xB3 ,0x84 ,0x1F ,0x31,
0x3B ,0x24 ,0x3A ,0x33 ,0x07 ,0x93 ,0xB6 ,0xB8 ,0xA5 ,0xBB ,0xB0 ,0x84 ,0x1C ,0x36 ,0x38 ,0x25,
0x3B ,0x30 ,0x05 ,0x9C ,0xB6 ,0xB8 ,0xA5 ,0xB8 ,0xB1 ,0x99 ,0x1B ,0x31 ,0x38 ,0x25 ,0x38 ,0x31,
0x18 ,0x99 ,0xB6 ,0xB9 ,0xBA ,0xBE ,0xB7 ,0x90 ,0x04 ,0x31 ,0x39 ,0x3A ,0x39 ,0x36 ,0x1A ,0x91,
0xB5 ,0xBC ,0xB9 ,0xBF ,0xB1 ,0x80 ,0x5B ,0x03 ,0x36 ,0x3D ,0x3C ,0x33 ,0x35 ,0x04 ,0x45 ,0x9F,
0x82 ,0x89 ,0x89 ,0x82 ,0x85 ,0x96 ,0xFF ,0x58 ,0x70 ,0x70 ,0x43 ,0xD4 ,0xDA ,0xD3 ,0x75 ,0x6F,
0x1D ,0x07 ,0x02 ,0x0F ,0x0C ,0x06 ,0x10 ,0xDE ,0x9D ,0x80 ,0x8E ,0x89 ,0x8C ,0x87 ,0x94 ,0x77,
0x1C ,0x00 ,0x09 ,0x0B ,0x0B ,0x0C ,0x07 ,0x14 ,0xC0 ,0x93 ,0x86 ,0x8C ,0x8E ,0x8C ,0x86 ,0x90,
0xDD ,0x17 ,0x05 ,0x00 ,0x0D ,0x02 ,0x00 ,0x04 ,0x12 ,0x60 ,0xCA ,0x97 ,0x9B ,0x86 ,0x81 ,0x81,
0x84 ,0x9D ,0xEF ,0x55 ,0x6F ,0x1C ,0x07 ,0x00 ,0x02 ,0x02 ,0x00 ,0x05 ,0x11 ,0x74 ,0xEC ,0x99,
0x81 ,0x82 ,0x82 ,0x87 ,0x92 ,0xF2 ,0x6D ,0x19 ,0x01 ,0x02 ,0x02 ,0x00 ,0x05 ,0x11 ,0x72 ,0xE5,
0x91 ,0x98 ,0x84 ,0x84 ,0x9A ,0x9D ,0xEA ,0xF3 ,0x74 ,0x6F ,0x11 ,0x1C ,0x19 ,0x1B ,0x1B ,0x18,
0x1C ,0x17 ,0x64 ,0xCB ,0x94 ,0x9B ,0x86 ,0x80 ,0x81 ,0x9A ,0x97 ,0xD8 ,0x6B ,0x1B ,0x01 ,0x0D,
0x0D ,0x00 ,0x05 ,0x14 ,0x52 ,0xEA ,0x9B ,0x81 ,0x82 ,0x83 ,0x86 ,0x99 ,0xEB ,0x55 ,0x68 ,0x1F,
0x04 ,0x01 ,0x00 ,0x06 ,0x05 ,0x12 ,0x63 ,0xC0 ,0x94 ,0x9B ,0x86 ,0x80 ,0x81 ,0x84 ,0x93 ,0xF8,
0x65 ,0x13 ,0x05 ,0x01 ,0x00 ,0x01 ,0x04 ,0x1E ,0x15 ,0x70 ,0xFC ,0x94 ,0x9E ,0x84 ,0x86 ,0x87,
0x85 ,0x93 ,0xE4 ,0x7D ,0x11 ,0x05 ,0x00 ,0x02 ,0x02 ,0x01 ,0x05 ,0x17 ,0x5C ,0x95 ,0x9A ,0x80,
0x82 ,0x80 ,0x85 ,0x96 ,0xF5 ,0x63 ,0x1D ,0x04 ,0x01 ,0x00 ,0x01 ,0x04 ,0x1E ,0x17 ,0x64 ,0xC4,
0xEF ,0x92 ,0x9A ,0x87 ,0x87 ,0x9A ,0x93 ,0xE7 ,0x71 ,0x16 ,0x1A ,0x01 ,0x02 ,0x02 ,0x00 ,0x04,
0x10 ,0x72 ,0xE3 ,0x9F ,0x86 ,0x83 ,0x83 ,0x86 ,0x9E ,0xEC ,0x40 ,0x14 ,0x1B ,0x06 ,0x03 ,0x03,
0x00 ,0x04 ,0x1D ,0x62 ,0xDA ,0xEB ,0x9E ,0x87 ,0x81 ,0x86 ,0x85 ,0x93 ,0xE4 ,0x7D ,0x16 ,0x1A,
};	


__audiodev gsAudio;	

void AUDIO_Init(void)
{	
	gsAudio.i2s_txbuf1=mymalloc(SRAMIN,I2S_DMA_BUF_SIZE);
	gsAudio.i2s_txbuf2=mymalloc(SRAMIN,I2S_DMA_BUF_SIZE);		
	gsAudio.i2s_rxbuf1=mymalloc(SRAMIN,I2S_DMA_BUF_SIZE);//I2S录音内存1申请
	gsAudio.i2s_rxbuf2=mymalloc(SRAMIN,I2S_DMA_BUF_SIZE);//I2S录音内存2申请
//	gsAudio.rtp_txbuf=mymalloc(SRAMIN,RTP_BUF_LEN);
//	gsAudio.rtp_rxbuf=mymalloc(SRAMIN,RTP_BUF_LEN);
	
	I2S2_Init(I2S_Standard_PCMShort,I2S_Mode_MasterTx,I2S_CPOL_Low,I2S_DataFormat_16b);			//PCM模式,主机发送,时钟低电平有效,16位帧长度 
	I2S2ext_Init(I2S_Standard_PCMShort,I2S_Mode_SlaveRx,I2S_CPOL_Low,I2S_DataFormat_16b);		//PCM模式,从机接收,时钟低电平有效,16位帧长度	
	I2S2_SampleRate_Set(8000);	//设置采样率 
	
	I2S2_TX_DMA_Init(gsAudio.i2s_txbuf1,gsAudio.i2s_txbuf2,I2S_DMA_BUF_SIZE/2); //配置TX DMA
	I2S2ext_RX_DMA_Init(gsAudio.i2s_rxbuf1,gsAudio.i2s_rxbuf2,I2S_DMA_BUF_SIZE/2); 	//配置RX DMA: 因为I2S数据长度16位所以RX_DMA_BUF_SIZE/2
	
	i2s_tx_callback=AUDIO_i2s_dma_tx_callback;			//回调函数指play_i2s_dma_callback
	i2s_rx_callback=AUDIO_i2s_dma_rx_callback;			//回调函数指rec_i2s_dma_callback
	
	
	
	I2S_Play_Stop();					//停止时钟发送
	I2S_Rec_Stop(); 					//停止录音
	gsAudio.rtp_rx_num =0;
	gRtpRxNum =0;
	gsAudio.rtp_tx_num =0;
	gRtpTxNum =0;
}

/*	 
//将Rec(ADC)采样数据
//buf:数据区
//size:填充数据量
//bits:位数(16/24)
*/
void AUDIO_recfill(u8 *buf,u16 size)
{
	u16 i,fill_len;
	fill_len =(size>>2);	//div 4
	for(i =0; i<fill_len; i++){
		gRtpTxBuf[gsAudio.rtp_tx_num][i] = buf[i*4+1];//*(buf+i*4+1);//		
	}			
	gsAudio.rtp_tx_num ++;
	gsAudio.rtp_tx_num &= (~RTP_BUF_NUM);	//注：必须是2,4,8,16....
//	printf("a=%d\r\n",gsAudio.rtp_tx_num);
} 
					
//录音 I2S_DMA接收中断服务函数.在中断里面写入数据
void AUDIO_i2s_dma_rx_callback(void) 
{ 
	if(DMA1_Stream3->CR&(1<<19))
	{
		AUDIO_recfill(gsAudio.i2s_rxbuf1,I2S_DMA_BUF_SIZE);			 
	}else 
	{
		AUDIO_recfill(gsAudio.i2s_rxbuf2,I2S_DMA_BUF_SIZE);		
	}
}  

void AUDIO_ringfill(u8 *buf,u16 size)
{
	static u32 hex_len=0;
	static u8 hex_flag,hex_times=0;
	u16 i,fill_len;	
	
	fill_len = (size>>2);		//div 8
	if(hex_flag ==0){
		for(i =0; i< fill_len; i++){
			buf[i*4+0]=gRingArr[hex_len];
			buf[i*4+1]=gRingArr[hex_len];
			buf[i*4+2]=gRingArr[hex_len];
			buf[i*4+3]=gRingArr[hex_len];
			hex_len++;
			if(hex_len>=RING_HEX_LEN){
				hex_len=0;
			}	
		}		
		hex_times ++;		
		if(hex_times ==100){
			hex_flag =1;
//			printf("%d\r\n",hex_len);
		}
	}
	else{
		for(i =0; i< size; i++){
			buf[i]=0xd5;
		}		
		hex_times ++;
		if(hex_times ==25){
			hex_flag =0;
			hex_len=368;
		}
	}	
}  


/*	 
//填充buf
//buf:数据区
//size:填充数据量
//bits:位数(16/24)
*/
void AUDIO_playfill(u8 *buf,u16 size)
{
	u16 i,j,fill_len;	
	fill_len = (size>>2);		//div 8
	if(gsAudio.rtp_rx_num != gRtpRxNum){
		for(i =0,j=12; i< fill_len; i++,j++){
			buf[i*4+0]=gRtpRxBuf[gsAudio.rtp_rx_num][j];
			buf[i*4+1]=gRtpRxBuf[gsAudio.rtp_rx_num][j];
			buf[i*4+2]=gRtpRxBuf[gsAudio.rtp_rx_num][j];
			buf[i*4+3]=gRtpRxBuf[gsAudio.rtp_rx_num][j];
		}	
		gsAudio.rtp_rx_num ++;
		gsAudio.rtp_rx_num &= (~RTP_BUF_NUM);	//注：必须是2,4,8,16....
	//	printf("a=%d\r\n",gsAudio.rtp_rx_num);
	}
}  

//WAV播放时,I2S DMA传输回调函数
void AUDIO_i2s_dma_tx_callback(void) 
{ 
	if(DMA1_Stream4->CR&(1<<19))
	{
		if(gsSipTxFlag.ringing ==1){
			AUDIO_ringfill(gsAudio.i2s_txbuf1,I2S_DMA_BUF_SIZE);
		}
		else{
			AUDIO_playfill(gsAudio.i2s_txbuf1,I2S_DMA_BUF_SIZE);
		}
	}else 
	{
		if(gsSipTxFlag.ringing ==1){
			AUDIO_ringfill(gsAudio.i2s_txbuf2,I2S_DMA_BUF_SIZE);
		}
		else{
			AUDIO_playfill(gsAudio.i2s_txbuf2,I2S_DMA_BUF_SIZE);
		}
	}
} 

/*
*/
void AUDIO_rec_mode(void)
{	
	I2S_Play_Start();		//开始I2S数据发送(主机)
	I2S_Rec_Start(); 		//开始I2S数据接收(从机)

//rtp packet
	gsAudio.rtp_rx_num =0;
	gRtpRxNum =0;
	gsAudio.rtp_tx_num =0;
	gRtpTxNum =0;
}

/*
*/	
void AUDIO_play_mode(void)
{
	I2S_Play_Start();					//停止时钟发送
}

void AUDIO_stop_mode(void)
{
	I2S_Play_Stop();					//停止时钟发送
	I2S_Rec_Stop(); 					//停止录音
}

